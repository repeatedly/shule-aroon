<div id="description">
  <h2>Select your Identity Provider</h2>
  <p>
    Select from following IdP list.
  </p>
</div>

<?r if cookies = get_common_domain_cookie ?>
<div id="recent_IdP">
  <p>Recently selected Identity Provider.</p>
  <ul>
    <?r cookies.each do |entity_id| ?>
    <li><a href="#{build_uri(entity_id)}">#{get_attribute(entity_id)[:name] || entity_id}</a></li>
    <?r end ?>
  </ul>
  <form action="./clear" method="get">
    <input type="hidden" name="query" value="#{request.query_string}">
    <input type="submit" value="Clear">
  </form>
</div>
<?r end ?>

<form id="select_IdP" action="./" method="get">
  <fieldset>
    <legend>Identity Provider List</legend>
    <input type="hidden" name="entityID" value="#{@params['entityID']}" />
    <input type="hidden" name="return" value="#{@params['return']}" />
    <input type="hidden" name="returnIDParam" value="#{returnIDParam}" />
    <select name="user_IdP">
    <?r Ramaze::Global.IdProviders.each_pair do |fed_name, idp| ?>
    <optgroup label="#{fed_name}">
      <?r idp.each_pair do |entity_id, value| ?>
      <option value="#{entity_id}">#{value[:name] || entity_id}</option>
      <?r end ?>
    </optgroup>
    <?r end ?>
    </select>
    <input type="submit" name="select_IdP" value="Select" /><br /><br />
    <p id="bypass_conf">DS bypass configuration.</p>
    <input type="radio" name="bypass" value="remember" id="remember" />
    <label for="remember">Remember this selection while closing browser.</label><br />
    <input type="radio" name="bypass" value="permanent" id="permanent" />
    <label for="permanent">Remember this selection permanently.</label>
  </fieldset>
</form>
